version: 1
frontend:
  phases:
    preBuild:
      commands:
        - "npm install -g pnpm"
        - "pnpm config set store-dir .pnpm-store"
        - "pnpm install"
        # Remove large deps that are not needed at runtime
        - "rm -rf node_modules/.pnpm/typescript*"
    build:
      commands:
        - "pnpm run build"
        - "mv node_modules ./.amplify-hosting/compute/default"
  artifacts:
    baseDirectory: .amplify-hosting
    files:
      - "**/*"
  cache:
    paths:
      - ".pnpm-store/**/*"
